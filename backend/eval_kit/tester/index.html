<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studio Test Runner</title>
    <link rel="stylesheet" href="/tester/styles.css">
</head>
<body>
    <div class="container">
        <h1>üß™ Studio Test Runner</h1>
        <p class="subtitle">Run predefined test cases with different models</p>

        <form id="testerForm">
            <div class="section">
                <label for="testCase">Test Case</label>
                <select id="testCase" name="testCase">
                    <option value="">Loading test cases...</option>
                </select>
                <div id="testInfo" class="test-info" style="display: none;">
                    <strong id="testName"></strong>
                    <div class="detail" id="testDescription"></div>
                    <div class="detail"><strong>Files:</strong> <span id="testFiles"></span></div>
                    <div class="detail"><strong>Section:</strong> <span id="testSection"></span></div>
                </div>
            </div>

            <div class="section">
                <label for="modelName">Model Name</label>
                <select id="modelName" name="modelName">
                    <option value="gpt-4o" selected>gpt-4o (Default)</option>
                    <option value="gpt-4o-mini">gpt-4o-mini (Faster, Cheaper)</option>
                    <option value="gpt-5.2-chat">gpt-5.2-chat</option>
                </select>
                <div id="modelInfo" class="model-info">
                    Selected model: <strong>gpt-4o</strong>
                </div>
            </div>

            <button type="submit" id="submitBtn">Run Test</button>
        </form>

        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Running test case...</p>
        </div>

        <div id="error" class="error" style="display: none;"></div>

        <div id="results" class="results">
            <!-- Test Case Details -->
            <div class="pipeline-step">
                <div class="step-header" onclick="toggleStep('testDetails')">
                    <div>
                        <div class="step-title">üìÑ Test Case Details</div>
                    </div>
                    <span class="toggle-icon" id="testDetails-icon">‚ñº</span>
                </div>
                <div class="step-content expanded" id="testDetails-content">
                    <div style="background: white; padding: 16px; border-radius: 4px;">
                        <div style="margin-bottom: 16px;">
                            <div style="font-weight: 600; color: #555; margin-bottom: 4px;">Files:</div>
                            <div id="testDetailsFiles" style="color: #333; padding-left: 12px;"></div>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <div style="font-weight: 600; color: #555; margin-bottom: 4px;">Section Name:</div>
                            <div id="testDetailsSectionName" style="color: #333; padding-left: 12px;"></div>
                        </div>
                        <div>
                            <div style="font-weight: 600; color: #555; margin-bottom: 4px;">Section Description:</div>
                            <div id="testDetailsSectionDescription" style="color: #333; padding-left: 12px; line-height: 1.6;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Processing Logs -->
            <div class="pipeline-step">
                <div class="step-header" onclick="toggleStep('logs')">
                    <div>
                        <div class="step-title">üìã Processing Logs</div>
                    </div>
                    <span class="toggle-icon" id="logs-icon">‚ñº</span>
                </div>
                <div class="step-content" id="logs-content">
                    <div id="logsList" style="background: #f9f9f9; padding: 12px; border-radius: 4px; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.8;"></div>
                </div>
            </div>

            <!-- Step 1: Search Queries -->
            <div class="pipeline-step">
                <div class="step-header" onclick="toggleStep('queries')">
                    <div>
                        <div class="step-title">1. Search Queries Generated</div>
                    </div>
                    <span class="toggle-icon" id="queries-icon">‚ñº</span>
                </div>
                <div class="step-content" id="queries-content">
                    <ul class="query-list" id="queryList"></ul>
                </div>
            </div>

            <!-- Step 2: Retrieved Chunks -->
            <div class="pipeline-step">
                <div class="step-header" onclick="toggleStep('chunks')">
                    <div>
                        <div class="step-title">2. Retrieved Chunks</div>
                    </div>
                    <span class="toggle-icon" id="chunks-icon">‚ñº</span>
                </div>
                <div class="step-content" id="chunks-content">
                    <div id="chunksSummary" style="background: #e3f2fd; padding: 12px; border-radius: 4px; margin-bottom: 16px; font-weight: 600; color: #1565c0;"></div>
                    <div id="chunkList"></div>
                </div>
            </div>

            <!-- Step 3: Numbered Context -->
            <div class="pipeline-step">
                <div class="step-header" onclick="toggleStep('context')">
                    <div>
                        <div class="step-title">3. Numbered Context (sent to AI)</div>
                    </div>
                    <span class="toggle-icon" id="context-icon">‚ñº</span>
                </div>
                <div class="step-content" id="context-content">
                    <pre id="contextText"></pre>
                </div>
            </div>

            <!-- Step 4: Cited Sources -->
            <div class="pipeline-step">
                <div class="step-header" onclick="toggleStep('cited')">
                    <div>
                        <div class="step-title">4. Cited Sources (lines referenced by AI)</div>
                    </div>
                    <span class="toggle-icon" id="cited-icon">‚ñº</span>
                </div>
                <div class="step-content expanded" id="cited-content">
                    <pre id="citedText"></pre>
                </div>
            </div>

            <!-- Step 5: AI Response -->
            <div class="pipeline-step">
                <div class="step-header" onclick="toggleStep('response')">
                    <div>
                        <div class="step-title">5. AI Response with Citations</div>
                    </div>
                    <span class="toggle-icon" id="response-icon">‚ñº</span>
                </div>
                <div class="step-content expanded" id="response-content">
                    <div id="responseText"></div>
                </div>
            </div>

            <!-- Step 6: Requirements (if any) -->
            <div class="pipeline-step" id="requirementsSection" style="display: none;">
                <div class="step-header" onclick="toggleStep('requirements')">
                    <div>
                        <div class="step-title">6. Requirements to Evaluate</div>
                    </div>
                    <span class="toggle-icon" id="requirements-icon">‚ñº</span>
                </div>
                <div class="step-content expanded" id="requirements-content">
                    <div style="background: white; padding: 16px; border-radius: 4px;">
                        <ul id="requirementsList" style="list-style: decimal; padding-left: 24px; margin: 0;">
                        </ul>
                        <div style="margin-top: 16px; display: flex; align-items: center; gap: 12px;">
                            <label for="evaluatorModel" style="font-weight: 600; color: #333; margin: 0;">Evaluator Model:</label>
                            <select id="evaluatorModel" style="flex: 1; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; font-family: inherit; background: white; cursor: pointer;">
                                <option value="gpt-4o" selected>gpt-4o (Default)</option>
                                <option value="gpt-4o-mini">gpt-4o-mini (Faster, Cheaper)</option>
                                <option value="gpt-5.2-chat">gpt-5.2-chat</option>
                            </select>
                            <button id="runEvaluationBtn" onclick="triggerEvaluation()" style="padding: 10px 20px; background: #2196F3; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; white-space: nowrap;">
                                üîç Run LLM Evaluation
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 7: LLM Evaluation -->
            <div class="pipeline-step" id="evaluationSection" style="display: none;">
                <div class="step-header" onclick="toggleStep('evaluation')">
                    <div>
                        <div class="step-title">7. LLM Evaluation Feedback</div>
                    </div>
                    <span class="toggle-icon" id="evaluation-icon">‚ñº</span>
                </div>
                <div class="step-content expanded" id="evaluation-content">
                    <div id="evaluationLoading" style="display: none; text-align: center; padding: 20px; color: #666;">
                        <div style="display: inline-block; border: 2px solid #f3f3f3; border-top: 2px solid #4CAF50; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite;"></div>
                        <p style="margin-top: 10px;">Evaluating output against requirements...</p>
                    </div>
                    <div id="evaluationModelInfo" style="background: #e8f5e9; padding: 8px 12px; border-radius: 4px; margin-bottom: 12px; color: #2e7d32; font-size: 13px; font-weight: 600; display: none;"></div>
                    <div id="evaluationText" style="background: white; padding: 16px; border-radius: 4px; line-height: 1.8; white-space: pre-wrap;"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="/tester/script.js"></script>
</body>
</html>
