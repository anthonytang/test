<policies>
  <inbound>
    <base />
    <validate-jwt header-name="Authorization"
                  require-scheme="Bearer"
                  failed-validation-httpcode="401"
                  failed-validation-error-message="Unauthorized">
      <openid-config url="https://login.microsoftonline.com/__TENANT_ID__/v2.0/.well-known/openid-configuration" />
      <audiences>
        <audience>__AUDIENCE__</audience>
        <audience>__CLIENT_ID__</audience>
      </audiences>
    </validate-jwt>
  </inbound>
  <backend>
    <!-- Disable response buffering for SSE streaming -->
    <forward-request timeout="600" buffer-response="false" />
  </backend>
  <outbound>
    <base />
    <!-- SSE headers to disable proxy buffering -->
    <set-header name="Cache-Control" exists-action="override">
      <value>no-cache, no-transform</value>
    </set-header>
    <set-header name="X-Accel-Buffering" exists-action="override">
      <value>no</value>
    </set-header>
  </outbound>
  <on-error>
    <base />
  </on-error>
</policies>
